<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
    MathJax = {
        tex: {
            displayMath: [['\\[', '\\]'], ['$$', '$$']],  
            inlineMath: [['$', '$']]                  
        },
        loader: {
            load: ['ui/safe']
        },
    };
</script>
  
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Triton Common Pitfalls | Da1sypetals</title>
<link rel="icon" href="/favicon.svg" sizes="any" type="image/svg+xml" /><meta property="og:url" content="http://localhost:1313/english-post/triton-pitfalls/">
  <meta property="og:site_name" content="Da1sypetals">
  <meta property="og:title" content="Triton Common Pitfalls">
  <meta property="og:description" content="From the perspective of a newbie user
The Documentation is a Disaster Recently, I had to optimize a custom operator and decided to use OpenAI’s Triton. After digging into the documentation, I was shocked at how poorly written it is — like an academic paper full of equations but lacking practical code examples.
If the library operates on tensors, the docs should clearly specify input/output shapes and provide concrete examples (like PyTorch does). Instead, everything is vaguely described in plain text, leaving users to guess the details.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="english-post">
    <meta property="article:published_time" content="2025-10-02T15:12:24+08:00">
    <meta property="article:modified_time" content="2025-10-02T15:12:24+08:00">
    <meta property="article:tag" content="Deep-Learning">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Triton">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Triton Common Pitfalls">
  <meta name="twitter:description" content="From the perspective of a newbie user
The Documentation is a Disaster Recently, I had to optimize a custom operator and decided to use OpenAI’s Triton. After digging into the documentation, I was shocked at how poorly written it is — like an academic paper full of equations but lacking practical code examples.
If the library operates on tensors, the docs should clearly specify input/output shapes and provide concrete examples (like PyTorch does). Instead, everything is vaguely described in plain text, leaving users to guess the details.">

    <link rel="stylesheet" href="/css/root.css">
    <link rel="stylesheet" href="/css/bundle.css">

      <script src="/js/bundle.js"></script><script defer src="/js/search/flexsearch.compact.5e0de3b335e5c523c7cf45473dc43fccb6c75f64a9d59cc04a6eccbb7c25eb49.js" integrity="sha256-Xg3jszXlxSPHz0VHPcQ/zLbHX2Sp1ZzASm7Mu3wl60k="></script>
<script defer src="/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js" integrity="sha256-HZgPhN8R8&#43;t8jF8X9UHUmgYRYI3xed10&#43;n8GIl61as4="></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

</head>

<body class="notransition">
  <div id="container">
    <header id="main-header"><div role="navigation" aria-label="Main">
  <div class="nav-left">
    <a href="http://localhost:1313/" style="color: inherit;">Da1sypetals</a>
  </div>
  <div class="nav-right">
    <div style="position:absolute;width:0px;height:0px;">
      <div id="nav-dropdown-menu" class="hidden" href="#">
    <div class="nav-item">
      <a href="/chinese-post/"
      >文章</a>
    </div>
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/english-post/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/about/"
      >关于我</a>
    </div>
</div>
    </div>
    <a id="nav-dropdown-button" href="#"><svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
    <div id="nav-menu">
    <div class="nav-item">
      <a href="/chinese-post/"
      >文章</a>
    </div>
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/english-post/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/about/"
      >关于我</a>
    </div>
</div>
    <a id="theme-switcher" href="#">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

<svg class="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
  </div>
</div>
</header>
    <div class="flex grow">
      <div id="main-pane">
        <main id="main-content"><div class="single-header">
<ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="http://localhost:1313/">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content='1' />
    </li>
    <span>&nbsp»&nbsp</span>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="http://localhost:1313/english-post/">
        <span itemprop="name">English-Posts</span>
      </a>
      <meta itemprop="position" content='2' />
    </li>
    <span>&nbsp»&nbsp</span>
</ol>
<h1>Triton Common Pitfalls</h1><time class="dim" datetime="2025-10-02T15:12:24&#43;08:00">October 2, 2025</time><div class="term-container"><div class="tag">
        <a href="http://localhost:1313/tags/deep-learning/">#deep-learning</a>
      </div><div class="tag">
        <a href="http://localhost:1313/tags/python/">#python</a>
      </div><div class="tag">
        <a href="http://localhost:1313/tags/triton/">#triton</a>
      </div></ol></div>
  <section class="page-section"><p>From the perspective of a newbie user</p>
<h2 id="the-documentation-is-a-disaster">The Documentation is a Disaster</h2>
<p>Recently, I had to optimize a custom operator and decided to use OpenAI&rsquo;s Triton. After digging into the documentation, I was shocked at how poorly written it is — like an academic paper full of equations but lacking practical code examples.</p>
<p>If the library operates on tensors, the docs should clearly specify input/output shapes and provide concrete examples (like PyTorch does). Instead, everything is vaguely described in plain text, leaving users to guess the details.</p>
<h2 id="how-triton-fails-at-clarity">How Triton Fails at Clarity</h2>
<p>Take the <a href="https://triton-lang.org/main/python-api/generated/triton.language.load.html#triton.language.load">tl.load documentation</a> as an example. It mentions that block pointers support &ldquo;boundary checks&rdquo; and &ldquo;padding options,&rdquo; but:</p>
<h3 id="what-does-boundary-check-actually-do">What does &ldquo;boundary check&rdquo; actually do?</h3>
<ul>
<li>Does it skip out-of-bounds elements, returning a smaller tensor?</li>
<li>Does it pad with a default value?</li>
<li>Does it throw an error?</li>
<li>The docs don&rsquo;t say.</li>
</ul>
<h3 id="whats-the-padding-option">What&rsquo;s the &ldquo;padding option&rdquo;?</h3>
<p>After some trial and error, I realized it handles out-of-bounds elements — but this should be explicitly stated, not left for users to reverse-engineer.</p>
<p>Another issue: <code>tl.make_block_ptr</code> and <code>tl.arange</code> require block shapes and element counts to be powers of two. This restriction isn&rsquo;t mentioned anywhere in the official docs. I only discovered it after hitting an error and finding a passing reference in an unofficial blog post.</p>
<p>Whoever wrote this documentation did a huge disservice to the engineers who built Triton&rsquo;s compiler. Triton&rsquo;s compiler is awesome.</p>
<h2 id="key-api-clarifications">Key API Clarifications</h2>
<h3 id="tlload">tl.load</h3>
<ul>
<li>For raw pointers (or tensors of pointers): Always set <code>mask</code> and <code>other</code>.
<ul>
<li><code>mask=True</code>: Load from HBM.</li>
<li><code>mask=False</code>: Use the value from <code>other</code> (a float).</li>
</ul>
</li>
<li>For block pointers (<code>tl.make_block_ptr</code>): Enable boundary checks on all dimensions and set <code>padding=&quot;zero&quot;</code>. The behavior of <code>boundary_check</code> is poorly defined, especially after reordering dimensions.</li>
</ul>
<h2 id="shape-constraints">Shape Constraints</h2>
<p><code>tl.arange</code> element counts and <code>tl.make_block_ptr</code> block shapes must be powers of two. This might apply to all Triton tensor dimensions, but I haven&rsquo;t verified it.</p>
<h2 id="memory-access-pitfalls">Memory Access Pitfalls</h2>
<ul>
<li><code>tl.load</code> and <code>tl.store</code> silently corrupt data. Invalid memory access turns values into <code>NaN</code>—yes, even <code>tl.store</code> can corrupt valid data!</li>
<li>Solution: Unless your dimensions are multiples of 64, always enable boundary checks for HBM reads/writes.</li>
<li>Extra caution: Raw pointers require careful <code>mask</code> handling to avoid disasters.</li>
</ul>
</section></main>
        <footer id="main-footer"><div class="footer">
  <a href="#">Scroll to Top</a>
  <div class="footer-copyright">
    <div class="dim">© 2025 Da1sypetals</div>
    <div>Made with ❤️ and powered by <a href="https://github.com/math-queiroz/rusty-typewriter" target="_blank">Rusty Typewriter</a> theme for <a href="https://gohugo.io/" target="_blank">Hugo</a></div>
  </div>
</div>
</footer>
      </div><aside id="side-pane" class="side-sticky"><div class="side-details">
    <span>359 words</span>
    <span>2 - 2 minutes read</span></div><h3>Table Of Contents</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#the-documentation-is-a-disaster">The Documentation is a Disaster</a></li>
    <li><a href="#how-triton-fails-at-clarity">How Triton Fails at Clarity</a>
      <ul>
        <li><a href="#what-does-boundary-check-actually-do">What does &ldquo;boundary check&rdquo; actually do?</a></li>
        <li><a href="#whats-the-padding-option">What&rsquo;s the &ldquo;padding option&rdquo;?</a></li>
      </ul>
    </li>
    <li><a href="#key-api-clarifications">Key API Clarifications</a>
      <ul>
        <li><a href="#tlload">tl.load</a></li>
      </ul>
    </li>
    <li><a href="#shape-constraints">Shape Constraints</a></li>
    <li><a href="#memory-access-pitfalls">Memory Access Pitfalls</a></li>
  </ul>
</nav><h3>Related</h3>
    <ul><li><a href="/english-post/snapviewer-3-optim/">SnapViewer Devlog #3: Optimizations</a></li><li><a href="/english-post/snapviewer-2-ui/">Snapviewer Devlog #2: UI</a></li><li><a href="/english-post/torch-cuda-ext/">Notes on Writing PyTorch CUDA Extensions</a></li><li><a href="/english-post/snapviewer/">SnapViewer: Faster PyTorch Memory Allocation Viewer</a></li></ul></aside></div>
  </div>
</body>

</html>